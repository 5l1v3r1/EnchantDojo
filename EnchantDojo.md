# EnchantDojo

## 概要
このドキュメントは [ドットインストール](http://dotinstall.com/ "ドットインストール") というサイトで公開されている「 [enchant.js入門](http://dotinstall.com/lessons/basic_enchant_js_v2 "enchant.js入門") 」に追加説明をするものです。

比較対象として [Scratch](http://scratch.mit.edu/ "Scratch") の事例を参照しますのでScratchを使ったことのない人は先にScratchを体験しておくとよいかもしれません。

またパソコン操作の基礎知識があることを前提としています。パソコンの操作については細かく説明しません。ご了承ください。


## 必要な環境
* パソコン
* インターネットに接続できる環境
* HTML5+JavaScriptをサポートしているブラウザ（Chrome、Firefoxなど）
* プログラムを入力するためのテキストエディタ


## 利用する教材
* ドットインストール [enchant.js入門](http://dotinstall.com/lessons/basic_enchant_js_v2 "enchant.js入門")


*****

# レッスン１

## [#01 enchant.jsとはなにか？](http://dotinstall.com/lessons/basic_enchant_js_v2/11501 "enchant.jsとはなにか？")
国産のゲーム開発用フレームワークである **enchant.js** について、その概要、公式サイト、必要となる知識やツールなどを解説していきます。

* 概要
* 公式サイト
* 必要となる知識
* 必要となるツール

# レッスン２

## [#02 開発の準備を進めよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11502 "開発の準備を進めよう")
最新版をダウンロードしたのちに必要なファイルを取り出し、開発の準備を進めていきます。

* 必要なファイルの準備
* main.jsの作成
* 動作確認

## 追加説明

### プログラム作成用フォルダの用意
ダウンロードするenchant.jsのファイルを置いたり、自分のプログラムを作る場所としてフォルダを作成します。

### enchant.jsの最新版をダウンロードするには
enchant.jsの公式ページ http://enchantjs.com/ja/ をブラウザで表示します。なお ja/ を付けないと英語のページが表示されます。

画面の上の方の「Download」をクリックします。次の図の矢印の先です。

![alt "図2-1"][lesson02-01]

    青いDownloadボタンでもダウンロードページへ移動できるのですが、こちらの方は英語のページへ移動してしまうようです。2013/03/19現在

ダウンロードページへ移動したら青いDownloadボタンを押すことでダウンロードが始まります。

次の図の矢印の先です。

![alt "図2-2"][lesson02-02]

### ダウンロードしたファイルを使えるようにする
まずはダウンロードしたファイルを移動します。移動先は先に用意しておいたプログラム作成用のフォルダです。

ダウンロードしたファイルはzipファイルという形式になっています。

このままでは使用できませんので「展開」する必要があります。

以下はzipファイルを展開する操作の例です。

* Macではファイルをダブルクリック
* Windowsではファイルを右クリックした後に表示されるメニューから「ここへ展開」を選択します。

### 自分のプログラム用フォルダの用意
自分のプログラムを保存するフォルダを作成します。

### 自分のプログラムを動かす
index.htmlをブラウザへドラッグ＆ドロップすることで動かすことができます。

プログラムを書き換えた後にはブラウザをリロードして動作を確認します。

### window.onload()
プログラムが始まることを表すwindow.onload()はScratchの「緑の旗がクリックされたら」みたいなものと考えてください。
onloadとは「ファイルが読み込まれたとき」といった意味です。

![alt "図2-4"][lesson02-04]


### JavaScriptコンソールの開き方
JavaScriptコンソールの開き方は使用しているブラウザによって違います。
以下の図はChromeとFirefoxでどのようにメニューをたどるとコンソールを表示できるかを説明した物です。

* Chrome 25では「ツール→JavaScriptコンソール」

![alt "図2-5"][lesson02-05]

* Firefox 19では「Web開発→Webコンソール」

![alt "図2-6"][lesson02-06]

# レッスン３

## [#03 クマを表示してみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11503 "クマを表示してみよう")
CoreやrootScene、Spriteの説明をしたのちにまずはクマの画像を表示してみます。

* Core、rootScene、Sprite
* Coreの設定
* bearの設定
* bearの設置
* 動作確認

## 追加説明

### 画像ファイルフォルダ
enchant.jsのフォルダの中に「<font color="blue">images</font>」という名前のフォルダがあります。

このフォルダの中にプログラムに利用できる画像が置いてあります。

### new Core(320, 320)の320についての話。
これはゲームを作る上でゲーム中に表示するものが見える範囲のサイズを指定しています。

このドキュメントではこの見える範囲のことをゲーム画面と呼ぶことにします。

なお320ではなく好きなサイズを指定することもできます。

ただしゲーム投稿サイト9leap.netでゲームを公開したいのであれば320を指定してください。

### シーンについて
シーン（Scene）とは、ゲーム画面に表示するものを管理する単位です。

ゲーム画面に表示したいキャラクタはシーンへ登録（addChild）する必要があります。逆に言うと登録しないと表示されません。

Scratchと違ってenchant.jsではスプライトが最初から表示されているわけではないため、表示するためのプログラムを書く必要があります。


### スプライトの表示位置
スプライトの表示位置はx座標、y座標という二つの値で指定します。

enchant.jsのゲーム画面においては画面の左上がx=0、y=0の座標となります。この座標は原点とも言います。

座標の指定は0から始まるため、320✕320サイズのゲーム画面におさまる座標の最大の値はx=319、y=319です。

スプライトが画面内に表示されているかどうかを判定する場合などに備えてこのルールを覚えておいてください。

次の図はxyの値を増やした場合に画面のどの方向に移動していくのかを表したものです。

スプライトはxの値を増やすと画面の右側へ、yの値を増やすと画面の左側へ移動していきます。

![alt "図3-1"][lesson03-01]

### Scratchにおける原点
Scratchでプログラムしていると普段気にすることは少ないと思いますが、原点は存在します。

Scratchはenchant.jsとは違いステージ（ゲーム画面）の中央が原点です。

そして次の図のようにx、yの値が変化します。図でも色分けしていますが四つの領域があると覚えておいてください。

![alt "図3-2"][lesson03-02]

### SpriteをrootSceneに乗せると表現していることの補足
動画の中で「SpriteをrootSceneに乗せる」と言っている箇所があります。

この乗せるの意味は先ほども書いた「ゲーム画面に表示したいキャラクタをシーンへ登録する(addChildする)」ということだと考えてください。

シーンへ登録するにはaddChildというメソッドを使います。

ちなみにchild（子供）と表現しているのはプログラムでデータを扱うときによく使われる構造に由来する表現です。興味がある人は調べてみてください。

# レッスン４

## [#04 クマを動かしてみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11504 "クマを動かしてみよう")
enterframeイベントを使ってクマを移動・回転・拡大させてみます。

* enterframeイベント
* 移動
* 回転（rotate）
* 拡大（scale）

## 追加説明

### フレーム
動画の解説にフレームという言葉がいきなり出てきます。

今後気をつけないといけないのはenchant.jsではフレームという言葉が意味する内容が状況によって変わることです。

レッスン４でのフレームの意味はゲームの進行にあわせてゲーム画面全体を書き換える１セットの操作のことを表します。

レッスン５でもフレームという言葉が出てきますがレッスン４とは違う意味のフレームです。

### enterframe
enterframeを無理矢理Scratchで説明すると「ずっと」の中身です。

イメージとしては次の図の赤い四角の部分です。enchant.jsでは「ずっと」に対応する部分はひとまず気にしなくて大丈夫なようになっています。

![alt text][lesson04-01]

### ゲーム画面のはし
クマが右側に歩いていって、あるところまで来たら左から登場する動きを表すプログラムについての補足です。
```javascript
if (this.x > 320) {
  this.x = 0;
}
```

これは「もしスプライトの表示位置がゲーム画面の外に出たら○○する」という意味です。（thisというのは状況で対象が変わるのですがここではbearのことです）

Scratchでいうところの「はしにさわったら」に近いものではあるのですが、でもやっぱり違います。

Scratchで近い動きを表現すると次のようなスクリプトになると思います。

![alt text][lesson04-02]

スプライトの表示位置とゲーム画面の端っこの関係についてのサンプルプログラムを用意しました。

このサンプルでは二頭のクマがそれぞれ右と左へ歩いていきます。

そして表示位置がゲーム画面の外に出たら停止するというプログラムになっています。

https://github.com/kivatek/EnchantCoordDemo

それぞれのクマが停止する位置の違いに注目してください。

右へ歩いたクマは見えなくなってから停止しますが、左へ歩いたクマは見えているうちに停止します。

これはスプライトの表示位置がスプライトの左上であることが理由です。レッスン３でも少し触れましたがスプライトがゲーム画面内にあるかどうかを判定する場合の重要なルールですのでよく覚えておいてください。

    enchant.jsに慣れてくるとスプライト表示を細かく設定できることが分かると思います。興味がある人は調べてみてください。

# レッスン５
## [#05 アニメーションを作ってみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11505 "アニメーションを作ってみよう")
Spriteのframeを操作することでアニメーションを実現していきます。

* Spriteのframe
* core.fps
* Spriteのage

## 追加説明

### フレーム(frame)
enchant.jsのスプライトは動いているように見える何枚かの画像を一枚の画像にまとめて扱います。

そしてスプライトをnewするときに指定したサイズで切り分けてゲーム画面に表示を行います。

enchant.jsでは指定サイズで切り分けた画像の一枚一枚をフレームと呼びます。レッスン４で出てきたフレームとは意味が異なります。注意してください。

次のプログラムは画像chara1.pngから横32ピクセル、縦32ピクセルのサイズで画像を切り分けてスプライトとして表示する例です。

```javascript
var bear = new Sprite(32,32);
bear.image = core.assets['chara1.png'];
bear.frame = 0;
```

スプライトを表示する際、何番目のフレームを表示するかを指定することができます。

たとえば上のプログラムの bear.frame = 0; の部分が表示するフレーム番号をしているプログラムの例です。この例だと棒立ちのクマを表示することになります。

フレーム番号は切り分ける前の画像の左上から右に向かって順番に割り当てられています。

フレーム番号の割り当てルールを説明する図を用意しました。

![alt text][lesson05-01]

ところで、上の図で９と表示されている箇所に注目してください。

ここにはクマの画像はありません。ありませんがフレーム番号９として存在します。

<font color="red">**人間が目で見てクマの絵が無いからといって番号をスキップするわけではありません。**</font>

もしプログラムでこのフレーム番号９を表示するように指定するとゲーム画面には何も表示されていないように見えるでしょう。

### age: 動き始めてからのフレーム数とは？
このフレームはレッスン４で出てきたフレームの意味です。

乱暴に説明するとプログラムが動き始めてからゲーム画面全体を書き換える操作を何回行ったかを表しています。

実は見た目の画面の変化が無くてもプログラム的には画面を書き換える操作が発生しているのです。

    サンプルプログラム準備中

### 剰余算
割り算を行ったときの「あまり」そのものを答えとする特別な計算です。

    剰余算の説明図準備中

### 指定したfpsで動かない？
パソコンの性能によっては設定したfpsで動作しないことがあります。

最近のパソコンだとあまり気になることはないと思いますが、少し前のパソコンを使っている場合にはゲームがカクカク動く場合があるかもしれません。

# レッスン６
## [#06 クマを操作してみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11506 "クマを操作してみよう")
矢印キーやタッチイベントでクマを動かしてみましょう。

* 上左右キーの入力
* Spriteのタッチイベント
* Coreのタッチイベント

## 追加説明
### 名前が違っても同じように動くメソッド
動画でも説明がありますがaddEventListenerという長いメソッド名の代わりにonと書いても同じように動きます。

難しく考えずに短いメソッド名onを使うと良いでしょう。

### タッチの情報を誰が受け取るか
ドットインストールのサンプルではタッチ情報をcore.rootSceneが受け取るようにプログラムされています。

サンプルのように簡単なプログラムであれば問題ないのですが、実際にゲームを作る場合にはcore.rootSceneを直接扱うのは避けた方がよいでしょう。

ではどうするかはエクストラの項目で説明します。

### 「e」って何？
eはeventの頭文字のeです。

enchant.jsにおけるeventとは何かが起こったことおよびその起こったことに関連する情報が詰まった宅配便とイメージしてください。

APIドキュメントのEventを見てみることを補足。

### 消えたクマの復活
後のレッスンで説明が無いようなのでこの段階で補足する。

見えなくするだけであればvisible=falseにする手段もある。この場合はタッチイベントに反応し続けることを説明。
可能であればサンプルプログラムの用意。


# レッスン７

## [#07 ラベルを表示してみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11507 "ラベルを表示してみよう")
ラベルを作成し、経過時間を表示させてみます。

* ラベルの作成
* 経過時間の表示

## 追加説明

ラベルとは？テキストとは？
日常の例を出して説明する。ラベルは写真があった方がいいかも。

カラー指定の他の色の文字列の事例。

フォント指定の他のフォントを指定する文字列。WindowsとMacの違いあることの説明。

core.frame / core.fpsについて補足説明。fpsは１秒間に何枚の絵を使ってぱらぱらアニメをしているかを表す。


# レッスン８

## [#08 衝突判定をしてみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11508 "衝突判定をしてみよう")
もう一つのクマを作り、キャラクター同士の衝突判定をしてみます。

* enemyの作成
* intersect
* within

## 追加説明

label.textへの代入をコメントアウトしたことで、intersectのif文は残っているのに機能しなくなることを補足。

### デモプログラム
intersectとwithinの動きを同時に見ることが出来るプログラムを用意しました。

プログラムはちょっと複雑に見えるかもしれませんが、内容はドットインストールで紹介されているものに準じています。

https://github.com/kivatek/EnchantCollisionDemo

# レッスン９

## [#09 ゲームオーバー処理をしてみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11509 "ゲームオーバー処理をしてみよう")
ゲームの停止方法、Sceneの作成・追加方法について学びます。

* Sceneの作成
* Sceneの表示
* core.stop()

## 追加説明

### rootSceneとgameOverSceneの切り替え

使用する紙芝居？本？カードのデッキ？が変わることを例に挙げて説明か？

pushSceneの動きを図解する。スタックの説明図みたいな感じで。

### core.stop()について
9leapに投稿するゲームの場合は使いません。

代わりにcore.end()を使用することで点数やコメントの登録を行えるようになります。

# レッスン１０

## [#10 クラスを作ってみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11510 "クラスを作ってみよう")
Spriteを拡張し、自分でクラスを作る方法を学びます。
* クラスの作成方法
* クラスの利用方法

## 追加説明

Bearクラスをcore.onloadの中に記述しているが実際にゲームを作るのであれば外に用意すべきであることを説明。

sceneへの追加はinitializeの中ではなく生成後に明示的に行った方がよいことを補足。

継承という概念を説明するかどうか。


# レッスン１１

## [#11 クマをたくさん表示させてみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11511 "クマをたくさん表示させてみよう")
クラスを使ってたくさんのクマを表示させてみます。

* 乱数生成の関数を作成
* クラスの変更
* クマの表示

## 追加説明

Math.floorについて簡単な説明

Math.randomについてはさいころを使った説明。

randomの範囲について補足するかどうか。
個人的には(n+1)ではなくて(n)の方がよいと思う。
それは配列の要素を選ぶような場合を考えると０オリジンで最大値未満の値という感覚を持っておいた方がよいと思うから。

[]と使うことで入れ物の用意をしていることを説明。画像としてはクッキーの箱とか？

透明度opacityが0から1の間の値をとるので１００で割るということについて補足。
この場合はMath.randomの結果をそのまま使ってもいいのではないだろうか？


# レッスン１２

## [#12 Timelineを使ってみよう](http://dotinstall.com/lessons/basic_enchant_js_v2/11512 "Timelineを使ってみよう")
アニメーションに特化したクラス、Timelineを使う方法について学びます。

* tl.moveBy()
* enchant.Easing
* tl.fadeIn() / tl.fadeOut(), tl.loop()

## 追加説明
easingについての公式サイトでの説明は[こちら](http://wise9.github.com/enchant.js/doc/core/ja/symbols/enchant.Easing.html)です。

Easingの動きの違いがわかるサンプルプログラムを用意しています。

なおサンプルで紹介しているのはたくさん用意されているEasingの一部の種類のみです。

https://github.com/kivatek/EnchantEasingDemo

### timelineの指定の書き方

timelineの指定をつなげて書く書き方の例。
```javascript
ball.tl.moveTo(80, 240, 48, enchant.Easing.BOUNCE_EASEOUT).
    then(function() {
        ball.y = 80;
    }).
    loop();
```

timelineの指定をつなげない書き方の例。
```javascript
ball.tl.moveTo(80, 240, 48, enchant.Easing.BOUNCE_EASEOUT);
ball.tl.then(function() {
    ball.y = 80;
});
ball.loop();
```

# エクストラ

## 背景色
ゲーム画面の背景が白色だと有効範囲がわかりづらいので色をつけるとよいかもしれません。

色を付ける場合は次のようにコードを修正します。rgb()の中の数字を0～255の値で書き換えることで自分の好きな色を表現できます。

```javascript
core.onload = function() {
	core.currentScene.backgroundColor = 'rgb(239, 228, 202)';
	
	// 省略
}
```

## Mapを使って地形の表示


## Groupをうまく使う
例えばＲＰＧにおいて壁の向こうに人が隠れて表示されるようにしたい場合は、スプライトを単純にaddChildするだけでは表現できません。

この様なときにはGroupという機能を使います。

Groupをものすごく乱暴に説明すると絵を表示しないスプライトと言えます。実際絵を表示すること以外はスプライトとだいたい同じことができます。

### Groupのメリット
* スプライトを目的別に管理しやすい
* 重ね合わせ表示のコントロールがしやすい
* メニューや点数表示のレイアウト調整に役立つ
    * Group自体の座標を動かすことでそのGroupにaddChildされているスプライトの表示位置を一気に動かすことができます。

## より複雑なtimelineの使い方
* and()
* then()
* repeat()

## Scratchの「○秒待つ」に対応するプログラムはちょっと面倒

## 9leap.netにゲームを投稿する
必要になるファイル。

* nineleap.enchant.js
* start.png
* end.png

### 画像ファイルstart.png、end.pngを置くフォルダ
nineleap.enchant.jsを使用する場合、画像ファイルstart.png、end.pngはソースファイルと同じフォルダに置きます。（次の図はWindows環境での一例です）

![alt "図Extra-4"][extra-04]

そうしないとアプリの起動に失敗します。（画像ファイルが見つからないことによるエラー）

### zipファイルの作成
9leapへのアップロードはzip形式の圧縮ファイルにしてアップロードすることになります。

* Windowsの場合はエクスプローラ上でアップロードするファイルを選んで右クリックメニューの「送る→圧縮(zip形式)フォルダー」

![alt "図Extra-5"][extra-05]

* Macの場合はファインダー上でアップロードするファイルを選んで

    本格的な手順となりますがgruntというツールを使うことで圧縮ファイルを作る手順を自動化することができます。ただし、ここでの説明は省略させてもらいます。



-- 脚注

-- 図一覧
[lesson02-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-01.png "図2-1"
[lesson02-02]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-02.png "図2-2"
[lesson02-03]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-03.png "図2-3"
[lesson02-04]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-04.png "図2-4"
[lesson02-05]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-05.png "図2-5"
[lesson02-06]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-06.png "図2-6"
[lesson03-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson03-01.png "図3-1"
[lesson03-02]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson03-02.png "図3-2"
[lesson04-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson04-01.png "図4-1"
[lesson04-02]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson04-02.png "図4-2"
[lesson05-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson05-01.png "図5-1"
[extra-04]: https://github.com/kivatek/EnchantDojo/raw/master/images/extra-04.png "図Extra-4"
[extra-05]: https://github.com/kivatek/EnchantDojo/raw/master/images/extra-05.png "図Extra-5"


