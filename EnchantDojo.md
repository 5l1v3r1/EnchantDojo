# EnchantDojo

## 概要
このドキュメントは [ドットインストール](http://dotinstall.com/ "ドットインストール") というサイトで公開されている「 [enchant.js入門](http://dotinstall.com/lessons/basic_enchant_js_v2 "enchant.js入門") 」に追加説明をするものです。
比較対象として [Scratch](http://scratch.mit.edu/ "Scratch") の事例を参照しますのでScratchを使ったことのない人は先にScratchを体験しておくとよいかもしれません。

またパソコン操作の基礎知識があることを前提としていますので、パソコンの操作については細かく説明しません。ご了承ください。



## 必要な環境
* パソコン
* インターネットに接続できる環境
* HTML5+JavaScriptをサポートしているブラウザ（Chrome、Firefoxなど）
* プログラムを入力するためのテキストエディタ


## 利用する教材

* ドットインストール enchant.js入門

http://dotinstall.com/lessons/basic_enchant_js_v2

*****

# レッスン１

### ドットインストールで紹介されている内容

#### #01 enchant.jsとはなにか？
国産のゲーム開発用フレームワークである **enchant.js** について、その概要、公式サイト、必要となる知識やツールなどを解説していきます。
* 概要
* 公式サイト
* 必要となる知識
* 必要となるツール

# レッスン２

### ドットインストールで紹介されている内容

#### #02 開発の準備を進めよう
最新版をダウンロードしたのちに必要なファイルを取り出し、開発の準備を進めていきます。
* 必要なファイルの準備
* main.jsの作成
* 動作確認

## 追加説明

### プログラム作成用フォルダの用意

### enchant.jsの最新版をダウンロードするには

enchant.jsの公式ページ http://enchantjs.com/ja/ をブラウザで表示します。

画面の上の方の「Download」をクリックします。次の図の矢印の先です。

![alt "図2-1"][lesson02-01]

（青いDownloadボタンでもダウンロードページへ移動できるのですが、こちらの方は英語のページへ移動してしまようです。2013/03/19現在）

ダウンロードページへ移動したら青いDownloadボタンを押すことでダウンロードが始まります。

次の図の矢印の先です。

![alt "図2-2"][lesson02-02]

### ダウンロードしたファイルを使えるようにする

ダウンロードしたファイルをまずは先ほど作成したプログラム作成用のフォルダに移動しましょう。

ダウンロードしたファイルはzipファイルという形式になっています。

このままでは使用できませんので「展開」する必要があります。

zipファイルの展開は、

    * Macではファイルをダブルクリック
    * Windowsではファイルを右クリックした後に表示されるメニューから「ここへ展開」を選択します。

### 自分のプログラム用フォルダの用意

### 自分のプログラムを動かす
index.htmlをブラウザへドラッグ＆ドロップすることで動かすことができます。

プログラムを書き換えた後にはブラウザをリロードして動作を確認します。

### window.onload()
プログラムが始まることを表すwindow.onload()はScratchの「緑の旗がクリックされたら」みたいなものと考えてください。
onloadとは「ファイルが読み込まれたとき」といった意味です。

![alt "図2-4"][lesson02-04]


### JavaScriptコンソールの開き方
JavaScriptコンソールの開き方は使用しているブラウザによって違います。
以下の図はChromeとFirefoxでどのようにメニューをたどるとコンソールを表示できるかを説明した物です。
   * Chrome 25では「ツール→JavaScriptコンソール」

![alt "図2-5"][lesson02-05]

   * Firefox 19では「Web開発→Webコンソール」

![alt "図2-6"][lesson02-06]

# レッスン３

### ドットインストールで紹介されている内容

#### #03 クマを表示してみよう
CoreやrootScene、Spriteの説明をしたのちにまずはクマの画像を表示してみます。
* Core、rootScene、Sprite
* Coreの設定
* bearの設定
* bearの設置
* 動作確認

## 追加説明

### 画像ファイルフォルダ
enchant.jsのフォルダの中に「images」という名前のフォルダがあります。

このフォルダの中にプログラムに利用できる画像が置いてあります。

### Scene
Scratchのステージとは違う。ステージとスプライトを合わせたもの？

### new Core(320, 320)の320についての話。
これはゲームを作る上でゲーム中に表示するものが見える範囲のサイズを指定しています。

このドキュメントではこの見える範囲のことをゲーム画面と呼ぶことにします。

なお320ではなく好きなサイズを指定することもできます。

もしゲーム投稿サイト9leap.netでゲームを公開したいのであれば320を指定してください。

### スプライトの表示位置
スプライトの表示位置はx座標、y座標という二つの値で指定します。

ゲーム画面においては画面の左上がx=0、y=0の座標となります。この座標は原点ということもあります。

このように座標の指定は0から始まるため、320✕320サイズのゲーム画面におさまる座標の最大の値はx=319、y=319です。

スプライトが画面内に表示されているかどうかを判定する場合などに備えてこのルールを覚えておいてください。

次の図はxyの値を増やした場合に画面のどの方向に移動していくのかを表したものです。

スプライトはxの値を増やすと画面の右側へ、yの値を増やすと画面の左側へ移動していきます。

![alt "図3-1"][lesson03-01]

なお、スプライトに設定する座標はスプライトの左上になります。

図を用意する。


### SpriteをrootSceneに乗せると表現していることの補足
ツリー構造を図解した方がよいか？

addChildとは？
Scratchと違ってSpriteが最初から表示されているわけではないこと。

ゲーム画面の有効範囲がわかりづらいので背景に色をつけてみる話。

# レッスン４

### ドットインストールで紹介されている内容

#### #04 クマを動かしてみよう
enterframeイベントを使ってクマを移動・回転・拡大させてみます。
* enterframeイベント
* 移動
* 回転（rotate）
* 拡大（scale）

## 追加説明

### ■フレーム
フレームという単語がいきなり出てくるので、ぱらぱら漫画あたりを使って説明する
→レッスン５での補足とまとめてよいかも。この時点ではおまじない。

### ■enterframe
enterframeを無理矢理Scratchで説明すると「ずっと」の中身です。
次の図の赤い四角の部分です。enchant.jsでは「ずっと」に対応する部分はひとまず気にしなくて大丈夫なようになっています。

![alt text][lesson04-01]

### ■ゲーム画面のはし

if (this.x > 320) {} についての補足。

![alt text][lesson04-02]

Scratchでいうところの「はしにさわったら」に近いけれどやっぱり違う。

# レッスン５

### ドットインストールで紹介されている内容

#### #05 アニメーションを作ってみよう
Spriteのframeを操作することでアニメーションを実現していきます。
* Spriteのframe
* core.fps
* Spriteのage

## 追加説明

### フレーム(frame)
enchant.jsのスプライトは動いているように見える何枚かの画像を一枚の画像にまとめて扱います。

そしてスプライトを用意するときに指定したサイズで切り分けてゲーム画面に表示を行います。

指定サイズで切り分けた画像の一枚一枚をフレームと呼びます。

次のプログラムは画像chara1.pngから横32ピクセル、縦32ピクセルのサイズで画像を切り分けながらスプライトとして表示する例です。

```javascript
    var bear = new Sprite(32,32);
    bear.image = core.assets['chara1.png'];
    bear.frame = 0;
```

スプライトを表示する際、何番目のフレームを表示するかを指定することができます。

たとえば上のプログラムの bear.frame = 0; の部分が表示するフレーム番号をしているプログラムの例です。

フレーム番号は切り分ける前の画像の左上から右に向かって順番に割り当てられています。

次の画像はドットインストールでも使用しているクマの画像のフレーム番号を説明したものです。

![alt text][lesson05-01]

xの加算値を５へ変更したのはScratchで言うところの○歩うごくに近いことを説明する。

### ageの説明補完
動き始めてからのフレーム数とは？
→別途説明用のプログラムを組んでもよいかもしれない。

剰余算の説明が必要か？

パソコンの性能によっては設定したfpsで動作しないことがあります。



# レッスン６

### ドットインストールで紹介されている内容

#### #06 クマを操作してみよう
矢印キーやタッチイベントでクマを動かしてみましょう。
* 上左右キーの入力
* Spriteのタッチイベント
* Coreのタッチイベント

## 追加説明

動画でも触れているがaddEventListenerの代わりにonと書いてもよい点を改めて説明。
タイプミスが減るのでこちらがよいと言ってもよさそう。

core.rootSceneへイベントをアタッチしているが、複雑なゲームを作る場合には別の方法がよいということを説明しておく。
エクストラでGroupを話題に出す。

eがeventのeであることを説明する。eventとは何かが起こったことおよびその起こったことに関連する情報をまとめたものであることを説明。

APIドキュメントのEventを見てみることを補足。

消えたクマの復活は？後ほどのレッスン？
後のレッスンで説明が無いようなのでこの段階で補足する。

見えなくするだけであればvisible=falseにする手段もある。この場合はタッチイベントに反応し続けることを説明。
可能であればサンプルプログラムの用意。


# レッスン７

### ドットインストールで紹介されている内容

#### #07 ラベルを表示してみよう
ラベルを作成し、経過時間を表示させてみます。
* ラベルの作成
* 経過時間の表示

## 追加説明

ラベルとは？テキストとは？
日常の例を出して説明する。ラベルは写真があった方がいいかも。

カラー指定の他の色の文字列の事例。

フォント指定の他のフォントを指定する文字列。WindowsとMacの違いあることの説明。

core.frame / core.fpsについて補足説明。fpsは１秒間に何枚の絵を使ってぱらぱらアニメをしているかを表す。


# レッスン８

### ドットインストールで紹介されている内容

#### #08 衝突判定をしてみよう
もう一つのクマを作り、キャラクター同士の衝突判定をしてみます。
* enemyの作成
* intersect
* within

## 追加説明

label.textへの代入をコメントアウトしたことで、intersectのif文は残っているのに機能しなくなることを補足。

### デモプログラム
intersectとwithinの動きを同時に見ることが出来るプログラムを用意しました。

プログラムはちょっと複雑に見えるかもしれませんが、内容はドットインストールで紹介されているものに準じています。

https://github.com/kivatek/EnchantCollisionDemo

# レッスン９

### ドットインストールで紹介されている内容

#### #09 ゲームオーバー処理をしてみよう
ゲームの停止方法、Sceneの作成・追加方法について学びます。
* Sceneの作成
* Sceneの表示
* core.stop()

## 追加説明

rootSceneとgameOverSceneの切り替えに関して。

使用する紙芝居？本？カードのデッキ？が変わることを例に挙げて説明か？

pushSceneの動きを図解する。スタックの説明図みたいな感じで。

core.stop()について。9leapに投稿するゲームの場合は使わない。使うのはend。

# レッスン１０

### ドットインストールで紹介されている内容

#### #10 クラスを作ってみよう
Spriteを拡張し、自分でクラスを作る方法を学びます。
* クラスの作成方法
* クラスの利用方法

## 追加説明

Bearクラスをcore.onloadの中に記述しているが実際にゲームを作るのであれば外に用意すべきであることを説明。

sceneへの追加はinitializeの中ではなく生成後に明示的に行った方がよいことを補足。

継承という概念を説明するかどうか。


# レッスン１１

### ドットインストールで紹介されている内容

#### #11 クマをたくさん表示させてみよう
クラスを使ってたくさんのクマを表示させてみます。
* 乱数生成の関数を作成
* クラスの変更
* クマの表示

## 追加説明

Math.floorについて簡単な説明

Math.randomについてはさいころを使った説明。

randomの範囲について補足するかどうか。
個人的には(n+1)ではなくて(n)の方がよいと思う。
それは配列の要素を選ぶような場合を考えると０オリジンで最大値未満の値という感覚を持っておいた方がよいと思うから。

[]と使うことで入れ物の用意をしていることを説明。画像としてはクッキーの箱とか？

透明度opacityが0から1の間の値をとるので１００で割るということについて補足。
この場合はMath.randomの結果をそのまま使ってもいいのではないだろうか？


# レッスン１２

### ドットインストールで紹介されている内容

#### #12 Timelineを使ってみよう
アニメーションに特化したクラス、Timelineを使う方法について学びます。
* tl.moveBy()
* enchant.Easing
* tl.fadeIn() / tl.fadeOut(), tl.loop()

## 追加説明

easingについての説明。
http://wise9.github.com/enchant.js/doc/core/ja/symbols/enchant.Easing.html

Easingの動きの違いがわかるサンプルプログラムを用意しています。

なおサンプルで紹介しているのはたくさん用意されているEasingの一部の種類のみです。

https://github.com/kivatek/EnchantEasingDemo

timelineの指定をつなげて書いていくスタイルについての説明。

timelineの指定をつなげて書く書き方の例。
```javascript
    ball.tl.moveTo(80, 240, 48, enchant.Easing.BOUNCE_EASEOUT).
        then(function() {
            ball.y = 80;
        }).
        loop();
```

timelineの指定をつなげない書き方の例。
```javascript
    ball.tl.moveTo(80, 240, 48, enchant.Easing.BOUNCE_EASEOUT);
    ball.tl.then(function() {
        ball.y = 80;
    });
    ball.loop();
```

# エクストラ

## Groupをうまく使う
重ね合わせをコントロールする話。
キャラクタが建物の影に隠れるＲＰＧ風サンプルプログラムの用意。手持ちのコードを再構成する。

Group自体の座標を動かすことでそのGroupにaddChildされているスプライトの表示位置を一気に動かすことができる。
→メニューや点数表示のレイアウト調整に役立つ

## より複雑なtimelineの使い方
* and()
* then()
* repeat()

## Scratchの「○秒待つ」に対応するプログラムはちょっと面倒

## 9leap.netにゲームを投稿する
必要になるファイル。
* nineleap.enchant.js
* start.png
* end.png

start.png、end.pngを置くフォルダ階層に注意する。

zipファイルの作成。

gruntの話。

# 脚注

# 図一覧
[lesson02-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-01.png "図2-1"
[lesson02-02]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-02.png "図2-2"
[lesson02-03]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-03.png "図2-3"
[lesson02-04]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-04.png "図2-4"
[lesson02-05]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-05.png "図2-5"
[lesson02-06]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson02-06.png "図2-6"
[lesson03-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson03-01.png "図3-1"
[lesson04-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson04-01.png "図4-1"
[lesson04-02]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson04-02.png "図4-2"
[lesson05-01]: https://github.com/kivatek/EnchantDojo/raw/master/images/lesson05-01.png "図5-1"


